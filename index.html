<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Focus Trainer: DS Edition (Easy)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            color: white;
            font-family: 'Pretendard', sans-serif;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
        }

        /* ì „ì²´ ê¸°ê¸° í”„ë ˆì„ */
        #ds-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #111;
            box-sizing: border-box;
        }

        /* === ìƒë‹¨ í™”ë©´ (ê²Œì„) === */
        #top-screen {
            flex: 1;
            position: relative;
            background: #000;
            border-bottom: 2px solid #333;
            overflow: hidden;
            margin: 5px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        canvas#game-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* ì²´ë ¥ ê²Œì´ì§€ */
        #hp-bar-container {
            position: absolute;
            top: 10px; left: 10px; right: 10px;
            height: 8px;
            background: #330000;
            border: 1px solid #666;
            border-radius: 4px;
            z-index: 10;
        }
        #hp-bar {
            width: 100%; height: 100%;
            background: linear-gradient(to right, #ff3333, #00ff00);
            transition: width 0.1s linear;
        }

        /* === í•˜ë‹¨ í™”ë©´ (í€´ì¦ˆ & ì»¨íŠ¸ë¡¤) === */
        #bottom-screen {
            flex: 1;
            position: relative;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 10px;
            margin: 5px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        /* í€´ì¦ˆ ì˜ì—­ */
        #quiz-area {
            width: 100%;
            height: 35%;
            background: #222;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 10px;
            box-sizing: border-box;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            margin-bottom: 10px;
        }

        .q-type { color: #aaa; font-size: 12px; margin-bottom: 5px; font-weight: bold; }
        .q-text { color: white; font-size: 18px; font-weight: bold; line-height: 1.3; word-break: keep-all; }
        .q-answer { color: #00ff00; font-size: 18px; margin-top: 5px; font-weight: bold; display: none; }
        .q-timer { color: #00ffff; font-size: 24px; margin-top: 5px; font-family: monospace; display: none;}
        
        #mic-status { font-size: 11px; color: #666; position: absolute; bottom: 5px; width: 100%; left: 0; }
        .listening { color: #ff5555 !important; animation: pulse 1s infinite; }

        /* ì¡°ì´ìŠ¤í‹± ì˜ì—­ */
        #joystick-area {
            width: 100%;
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #stick-base {
            width: 140px;
            height: 140px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            position: relative;
            touch-action: none;
        }

        #stick-knob {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle at 30% 30%, #00ffff, #008888);
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 15px #00ffff;
            pointer-events: none;
        }

        /* ì˜¤ë²„ë ˆì´ */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        #game-over { display: none; z-index: 200; }

        .btn-start {
            padding: 15px 40px;
            font-size: 20px;
            background: #00ff00;
            color: black;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn-retry { background: #ff3333; color: white; }

        /* ì„¤ì • UI */
        .settings-box {
            width: 85%;
            background: #222;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .radio-group { display: flex; justify-content: space-between; margin-bottom: 10px; }
        label { display: flex; align-items: center; gap: 5px; cursor: pointer; color: #ddd; font-size: 14px; }
        textarea { width: 100%; height: 80px; background: #111; color: #ddd; border: 1px solid #444; box-sizing: border-box; padding: 5px; }

        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="ds-container">
    <!-- ìƒë‹¨ í™”ë©´ -->
    <div id="top-screen">
        <canvas id="game-canvas"></canvas>
        <div id="hp-bar-container"><div id="hp-bar"></div></div>
        
        <div id="game-over" class="overlay">
            <h1 style="color:red">TRAINING FAILED</h1>
            <p>ì˜ì—­ ì´íƒˆë¡œ ì¸í•œ ë¯¸ì…˜ ì‹¤íŒ¨</p>
            <button class="btn-start btn-retry" onclick="location.reload()">ì¬ì‹œë„</button>
        </div>
    </div>

    <!-- í•˜ë‹¨ í™”ë©´ -->
    <div id="bottom-screen">
        <div id="quiz-area">
            <div class="q-type" id="q-type">READY</div>
            <div class="q-text" id="q-text">ì¤€ë¹„ë˜ë©´ ì•„ë˜ ìŠ¤í‹±ì„ ì›€ì§ì´ì„¸ìš”</div>
            <div class="q-timer" id="q-timer">00.00</div>
            <div class="q-answer" id="q-answer">ì •ë‹µ</div>
            <div id="mic-status">ë§ˆì´í¬ ëŒ€ê¸° ì¤‘...</div>
        </div>

        <div id="joystick-area">
            <div id="stick-base">
                <div id="stick-knob"></div>
            </div>
        </div>
    </div>

    <!-- ì‹œì‘ ì„¤ì • -->
    <div id="start-screen" class="overlay">
        <h2 style="color:#00ff00; margin-bottom:20px;">Focus Trainer DS</h2>
        
        <div class="settings-box">
            <div style="color:#aaa; margin-bottom:5px; font-size:14px;">ë‚œì´ë„ ì„¤ì • (ì†ë„)</div>
            <div class="radio-group">
                <label><input type="radio" name="diff" value="easy"> ì‰¬ì›€</label>
                <label><input type="radio" name="diff" value="normal" checked> ë³´í†µ</label>
                <label><input type="radio" name="diff" value="hard"> ì–´ë ¤ì›€</label>
            </div>
            
            <div style="color:#aaa; margin-bottom:5px; font-size:14px; margin-top:15px;">ìŒì„± ì¸ì‹</div>
            <label><input type="checkbox" id="use-voice" checked> ì‚¬ìš© (Chrome ê¶Œì¥)</label>
            
            <div style="color:#aaa; margin-bottom:5px; font-size:14px; margin-top:15px;">í›ˆë ¨ ë°ì´í„° (JSON)</div>
            <textarea id="custom-data"></textarea>
        </div>

        <button class="btn-start" onclick="app.init()">START MISSION</button>
    </div>
</div>

<script>
const DEFAULT_DATA = [
    { q: "ì² ë„ì°¨ëŸ‰ ìš´ì „ë©´í—ˆ ê°±ì‹  ì£¼ê¸°ëŠ”?", a: "10ë…„" },
    { q: "7400í˜¸ëŒ€ ìµœê³ ì†ë„ëŠ”?", a: "150km/h" },
    { q: "ë¹„ìƒì œë™ì‹œ ê³µê¸°ì•• ë³€í™”ëŠ”?", a: "ì œë™ê´€ ì••ë ¥ 0ìœ¼ë¡œ ê¸‰ë°°ê¸°" },
    { q: "í•œêµ­ì˜ ìˆ˜ë„ëŠ”?", a: "ì„œìš¸" }
];

class Joystick {
    constructor(baseId, knobId, onMove) {
        this.base = document.getElementById(baseId);
        this.knob = document.getElementById(knobId);
        this.onMove = onMove; 
        
        this.active = false;
        this.touchId = null;
        this.center = { x: 0, y: 0 };
        this.radius = 70;

        this.base.addEventListener('touchstart', e => this.start(e), {passive: false});
        this.base.addEventListener('touchmove', e => this.move(e), {passive: false});
        this.base.addEventListener('touchend', e => this.end(e));
        
        this.base.addEventListener('mousedown', e => this.start(e));
        document.addEventListener('mousemove', e => this.move(e));
        document.addEventListener('mouseup', e => this.end(e));
    }

    start(e) {
        e.preventDefault();
        this.active = true;
        const rect = this.base.getBoundingClientRect();
        this.center = { x: rect.left + rect.width/2, y: rect.top + rect.height/2 };
        if (e.touches) this.touchId = e.changedTouches[0].identifier;
        this.updateKnob(e);
    }

    move(e) {
        if (!this.active) return;
        e.preventDefault();
        this.updateKnob(e);
    }

    end(e) {
        if (!this.active) return;
        this.active = false;
        this.knob.style.transform = `translate(-50%, -50%)`;
        this.onMove(0, 0); 
    }

    updateKnob(e) {
        let clientX, clientY;
        if (e.touches) {
            for(let i=0; i<e.changedTouches.length; i++) {
                if(e.changedTouches[i].identifier === this.touchId) {
                    clientX = e.changedTouches[i].clientX;
                    clientY = e.changedTouches[i].clientY;
                    break;
                }
            }
            if (clientX === undefined) return;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }

        const dx = clientX - this.center.x;
        const dy = clientY - this.center.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        const actualDist = Math.min(dist, this.radius);
        const angle = Math.atan2(dy, dx);
        
        const knobX = Math.cos(angle) * actualDist;
        const knobY = Math.sin(angle) * actualDist;

        this.knob.style.transform = `translate(calc(-50% + ${knobX}px), calc(-50% + ${knobY}px))`;
        this.onMove(knobX / this.radius, knobY / this.radius);
    }
}

class TrackerGame {
    constructor(canvasId) {
        this.canvas = document.getElementById(canvasId);
        this.ctx = this.canvas.getContext('2d');
        
        this.player = { x: 0, y: 0, radius: 8, vx: 0, vy: 0 };
        this.zone = { 
            x: 0, y: 0, 
            width: 100, height: 100, 
            radius: 0, 
            targetX: 0, targetY: 0 
        };
        this.easyDir = {x:0, y:0};
        
        this.difficulty = 'normal'; 
        this.playerSpeed = 5; 
        this.zoneMaxSpeed = 0; 
        
        this.health = 100;
        this.active = false;
        this.moveTimer = 0; 
        
        this.resize();
        window.addEventListener('resize', () => this.resize());
    }

    resize() {
        this.canvas.width = this.canvas.parentElement.clientWidth;
        this.canvas.height = this.canvas.parentElement.clientHeight;
        if (!this.active) {
            this.player.x = this.canvas.width / 2;
            this.player.y = this.canvas.height / 2;
            this.zone.x = this.canvas.width / 2;
            this.zone.y = this.canvas.height / 2;
        }
    }

    start(diff) {
        this.difficulty = diff;
        this.active = true;
        this.health = 100;
        
        this.player.x = this.canvas.width / 2;
        this.player.y = this.canvas.height / 2;
        this.zone.x = this.canvas.width / 2;
        this.zone.y = this.canvas.height / 2;
        this.zone.targetX = this.zone.x;
        this.zone.targetY = this.zone.y;

        // ë‚œì´ë„ë³„ ì†ë„ ë° íŒ¨í„´ ì„¤ì • (ë” ì‰½ê²Œ ì¡°ì •)
        if (diff === 'easy') {
            this.zoneMaxSpeed = this.playerSpeed * 0.2; // ë§¤ìš° ëŠë¦¼
            this.zone.width = 140; this.zone.height = 140; // ë” ë„“ê²Œ
            this.zone.radius = 0;
        } else if (diff === 'normal') {
            this.zoneMaxSpeed = this.playerSpeed * 0.4; // ëŠë¦¼
            this.zone.width = 120; this.zone.height = 120;
            this.zone.radius = 10; 
        } else {
            this.zoneMaxSpeed = this.playerSpeed * 0.6; // ì ë‹¹í•¨
            this.zone.width = 100; this.zone.height = 100;
            this.zone.radius = 10;
        }
    }

    setInput(x, y) {
        this.player.vx = x * this.playerSpeed;
        this.player.vy = y * this.playerSpeed;
    }

    update() {
        if (!this.active) return;

        this.player.x += this.player.vx;
        this.player.y += this.player.vy;
        this.player.x = Math.max(0, Math.min(this.canvas.width, this.player.x));
        this.player.y = Math.max(0, Math.min(this.canvas.height, this.player.y));

        this.updateZoneAI();
        this.checkCollision();
    }

    updateZoneAI() {
        const pad = 80;

        if (this.difficulty === 'easy') {
            // ë‹¨ìˆœ ì§ì„  ì´ë™ (Lerp)
            if (this.moveTimer <= 0) {
                this.zone.targetX = pad + Math.random() * (this.canvas.width - pad*2);
                this.zone.targetY = pad + Math.random() * (this.canvas.height - pad*2);
                this.moveTimer = 200; // 3~4ì´ˆë§ˆë‹¤ ë³€ê²½ (ì²œì²œíˆ)
            }
            this.moveTimer--;

            // ì•„ì£¼ ì²œì²œíˆ ëª©í‘œë¡œ ì´ë™
            this.zone.x += (this.zone.targetX - this.zone.x) * 0.005;
            this.zone.y += (this.zone.targetY - this.zone.y) * 0.005;
        } 
        else if (this.difficulty === 'normal') {
            // ì¡°ê¸ˆ ë” ë¹ ë¥¸ ì§ì„  ì´ë™
            if (this.moveTimer <= 0) {
                this.zone.targetX = pad + Math.random() * (this.canvas.width - pad*2);
                this.zone.targetY = pad + Math.random() * (this.canvas.height - pad*2);
                this.moveTimer = 120; // 2ì´ˆë§ˆë‹¤
            }
            this.moveTimer--;

            this.zone.x += (this.zone.targetX - this.zone.x) * 0.01;
            this.zone.y += (this.zone.targetY - this.zone.y) * 0.01;
        }
        else {
            // Hard: ì´ì „ Normal ìˆ˜ì¤€ì˜ ì›€ì§ì„
            const dx = this.zone.targetX - this.zone.x;
            const dy = this.zone.targetY - this.zone.y;
            const dist = Math.sqrt(dx*dx + dy*dy);

            if (dist < 10 || this.moveTimer <= 0) {
                this.zone.targetX = pad + Math.random() * (this.canvas.width - pad*2);
                this.zone.targetY = pad + Math.random() * (this.canvas.height - pad*2);
                this.moveTimer = 60 + Math.random() * 60;
            }
            this.moveTimer--;

            const angle = Math.atan2(dy, dx);
            this.zone.x += Math.cos(angle) * this.zoneMaxSpeed;
            this.zone.y += Math.sin(angle) * this.zoneMaxSpeed;
            
            // ëª¨ì–‘ ë³€í™”
            const time = Date.now() / 1000;
            const morphFactor = (Math.sin(time) + 1) / 2;
            this.zone.radius = 10 + (morphFactor * 20);
        }

        this.zone.x = Math.max(pad, Math.min(this.canvas.width - pad, this.zone.x));
        this.zone.y = Math.max(pad, Math.min(this.canvas.height - pad, this.zone.y));
    }

    checkCollision() {
        const halfW = this.zone.width / 2;
        const halfH = this.zone.height / 2;
        const dx = Math.abs(this.player.x - this.zone.x);
        const dy = Math.abs(this.player.y - this.zone.y);

        let inside = false;

        // ì¶©ëŒ íŒì • ë‹¨ìˆœí™” (ëª¨ë‘ ë°•ìŠ¤ë¡œ ì²˜ë¦¬)
        if (dx < halfW && dy < halfH) inside = true;

        const hpBar = document.getElementById('hp-bar');

        if (inside) {
            this.ctx.strokeStyle = "#00ff00"; 
            this.health = Math.min(100, this.health + 0.1);
        } else {
            this.ctx.strokeStyle = "#ff0000"; 
            // ì²´ë ¥ ê°ì†Œ ëŒ€í­ ì™„í™” (ê³ ì •ê°’)
            this.health -= 0.05; // ê¸°ì¡´ 0.2 -> 0.05 (1/4 ìˆ˜ì¤€)
            
            if (this.health <= 0) {
                this.health = 0;
                app.gameOver();
            }
        }
        
        hpBar.style.width = this.health + "%";
    }

    render() {
        this.ctx.fillStyle = "#000";
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

        this.ctx.strokeStyle = "#222";
        this.ctx.lineWidth = 1;
        const gridSize = 50;
        
        this.ctx.beginPath();
        for(let x=0; x<this.canvas.width; x+=gridSize) {
            this.ctx.moveTo(x, 0); this.ctx.lineTo(x, this.canvas.height);
        }
        for(let y=0; y<this.canvas.height; y+=gridSize) {
            this.ctx.moveTo(0, y); this.ctx.lineTo(this.canvas.width, y);
        }
        this.ctx.stroke();

        this.ctx.lineWidth = 4;
        this.drawRoundRect(this.zone.x - this.zone.width/2, this.zone.y - this.zone.height/2, 
                           this.zone.width, this.zone.height, this.zone.radius);
        this.ctx.stroke();
        
        this.ctx.fillStyle = this.ctx.strokeStyle === "#00ff00" ? "rgba(0, 255, 0, 0.1)" : "rgba(255, 0, 0, 0.1)";
        this.ctx.fill();

        this.ctx.fillStyle = "#00ffff";
        this.ctx.shadowBlur = 10;
        this.ctx.shadowColor = "#00ffff";
        this.ctx.beginPath();
        this.ctx.arc(this.player.x, this.player.y, this.player.radius, 0, Math.PI*2);
        this.ctx.fill();
        this.ctx.shadowBlur = 0;
    }

    drawRoundRect(x, y, w, h, r) {
        this.ctx.beginPath();
        this.ctx.moveTo(x + r, y);
        this.ctx.arcTo(x + w, y, x + w, y + h, r);
        this.ctx.arcTo(x + w, y + h, x, y + h, r);
        this.ctx.arcTo(x, y + h, x, y, r);
        this.ctx.arcTo(x, y, x + w, y, r);
        this.ctx.closePath();
    }
}

class QuizManager {
    constructor() {
        this.data = [];
        this.active = false;
        this.state = 'idle'; 
        this.timerStart = 0;
        this.timerRef = null;
        this.nextTimer = null;
        this.useVoice = false;
        this.recognition = null;
        this.initVoice();
    }

    initVoice() {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SR) {
            this.recognition = new SR();
            this.recognition.lang = 'ko-KR';
            this.recognition.continuous = true;
            this.recognition.interimResults = false;
            this.recognition.onresult = (e) => {
                const txt = e.results[e.results.length-1][0].transcript.replace(/\s/g, '');
                this.processVoice(txt);
            };
            this.recognition.onend = () => {
                if (this.active && this.useVoice) try{this.recognition.start()}catch(e){}
            };
        }
    }

    processVoice(txt) {
        console.log("Voice:", txt);
        if (this.state === 'question') {
            if (txt.startsWith('ì˜ˆ') || txt.startsWith('ë„¤')) this.startAnswering();
        } else if (this.state === 'answering') {
            if (txt.includes('ì´ìƒ') || txt.includes('ë')) this.finishAnswering();
        }
    }

    setData(jsonString) {
        try {
            this.data = JSON.parse(jsonString);
        } catch(e) {
            alert("JSON íŒŒì‹± ì˜¤ë¥˜. ê¸°ë³¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
            this.data = DEFAULT_DATA;
        }
    }

    start(useVoice) {
        this.active = true;
        this.useVoice = useVoice;
        if (useVoice && this.recognition) try{this.recognition.start()}catch(e){}
        this.scheduleNext();
    }

    stop() {
        this.active = false;
        if (this.recognition) try{this.recognition.stop()}catch(e){}
        clearTimeout(this.nextTimer);
        cancelAnimationFrame(this.timerRef);
    }

    scheduleNext() {
        const delay = 3000 + Math.random() * 3000;
        this.state = 'idle';
        document.getElementById('q-type').innerText = "STANDBY";
        document.getElementById('q-text').innerText = "ë‹¤ìŒ ë¬¸ì œ ëŒ€ê¸° ì¤‘...";
        document.getElementById('q-answer').style.display = 'none';
        document.getElementById('q-timer').style.display = 'none';
        document.getElementById('mic-status').innerText = "ì¹¨ë¬µ ìœ ì§€";
        document.getElementById('mic-status').className = "";
        this.nextTimer = setTimeout(() => this.showQuestion(), delay);
    }

    showQuestion() {
        if (!this.active) return;
        const q = this.data[Math.floor(Math.random() * this.data.length)];
        this.currentQ = q;
        this.state = 'question';
        document.getElementById('q-type').innerText = "QUESTION";
        document.getElementById('q-text').innerText = q.q;
        const micEl = document.getElementById('mic-status');
        if (this.useVoice) {
            micEl.innerText = "ğŸ¤ 'ì˜ˆ'ë¼ê³  ë‹µí•˜ë©´ ì‹œì‘";
            micEl.className = "listening";
        } else {
            micEl.innerText = "í„°ì¹˜í•˜ì—¬ ë‹µë³€ ì‹œì‘";
            micEl.className = "";
        }
    }

    startAnswering() {
        this.state = 'answering';
        this.timerStart = performance.now();
        document.getElementById('q-type').innerText = "RECORDING...";
        document.getElementById('q-timer').style.display = 'block';
        document.getElementById('q-answer').style.display = 'none';
        const micEl = document.getElementById('mic-status');
        if (this.useVoice) {
            micEl.innerText = "ğŸ—£ï¸ ë‹µë³€ í›„ 'ì´ìƒì…ë‹ˆë‹¤' ë°œì–¸";
        } else {
            micEl.innerText = "ë‹µë³€ í›„ í„°ì¹˜í•˜ì—¬ ì¢…ë£Œ";
        }
        this.updateTimer();
    }

    updateTimer() {
        if (this.state !== 'answering') return;
        const now = performance.now();
        const t = (now - this.timerStart) / 1000;
        document.getElementById('q-timer').innerText = t.toFixed(2);
        this.timerRef = requestAnimationFrame(() => this.updateTimer());
    }

    finishAnswering() {
        this.state = 'result';
        cancelAnimationFrame(this.timerRef);
        document.getElementById('q-type').innerText = "RESULT";
        document.getElementById('q-answer').innerText = this.currentQ.a;
        document.getElementById('q-answer').style.display = 'block';
        document.getElementById('mic-status').innerText = "3ì´ˆ í›„ ìë™ ë‹«í˜";
        document.getElementById('mic-status').className = "";
        setTimeout(() => {
            if(this.active) this.scheduleNext();
        }, 3000);
    }

    handleTouch() {
        if (this.state === 'question') this.startAnswering();
        else if (this.state === 'answering') this.finishAnswering();
    }
}

const tracker = new TrackerGame('game-canvas');
const quiz = new QuizManager();

const app = {
    init: function() {
        const diff = document.querySelector('input[name="diff"]:checked').value;
        const useVoice = document.getElementById('use-voice').checked;
        const jsonText = document.getElementById('custom-data').value;
        document.getElementById('custom-data').value = jsonText;
        quiz.setData(jsonText);
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-over').style.display = 'none';
        tracker.start(diff);
        quiz.start(useVoice);
        this.loop();
    },
    loop: function() {
        if (!tracker.active) return;
        tracker.update();
        tracker.render();
        requestAnimationFrame(() => this.loop());
    },
    gameOver: function() {
        tracker.active = false;
        quiz.stop();
        document.getElementById('game-over').style.display = 'flex';
    }
};

document.getElementById('custom-data').value = JSON.stringify(DEFAULT_DATA, null, 4);

new Joystick('stick-base', 'stick-knob', (x, y) => {
    tracker.setInput(x, y);
});

document.getElementById('quiz-area').addEventListener('mousedown', () => quiz.handleTouch());
document.getElementById('quiz-area').addEventListener('touchstart', (e) => {
    e.preventDefault();
    quiz.handleTouch();
});

</script>
</body>
</html>
